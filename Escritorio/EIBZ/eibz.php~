<?php

	require_once '/var/www/html/qa-include/qa-base.php';

	//require_once QA_INCLUDE_DIR.'qa-app-users.php';
	require_once QA_INCLUDE_DIR.'qa-app-posts.php';

 	

//Lee el fichero en una variable y convierte su contenido a una estructura de datos
$str_datos = file_get_contents("/home/alex/Escritorio/EIBZ/resultadoEIBZ.json");
$datos = json_decode($str_datos,true);

//Cogemos fecha actual y le quitamos los dias desde la ultima actualizacion
$Date=Date('Y/m/d', strtotime("-7 days"));

foreach($datos as $doc){

        $izenburua = $doc['results'][0]['izenburua'];
        $edukia = $doc['results'][0]['edukia'];
	$dataGaldera = $doc['results'][0]['data'];

	$split = explode('Erantzuna', $edukia, 2);	

	$galdera = $split[0];
	$erantzuna = $split[1];

	if($dataGaldera != NULL and $dataGaldera > $Date){

	//galdera
	$type= 'Q';	//question
	$parentid= null;	//does not follow another answer
	$title= $izenburua;
	$content= $galdera;
	$format= '';	//plain text
	$categoryid= null;	//assume no category
	$tags= '';
	$userid=  4;

	$postId = qa_post_create($type, $parentid, $title, $content, $format, $categoryid, $tags, $userid);
	
	//erantzuna
	$type= 'A';	//answer
	$parentid= $postId;
	$title= null;
	$content= $erantzuna;

	qa_post_create($type, $parentid, $title, $content, $format, $categoryid, $tags, $userid);

	}
}
